## [Codeforces 935E - Fafa and Ancient Mathematics](http://codeforces.com/problemset/problem/935/E)

### 题意

进行以下定义：
* $d$ 是表达式，其中 $d = 1 \sim 9$；
* $(E_1 \text{ op } E_2)$ 是表达式，其中 $E_1$ 和 $E_2$ 都是表达式，op 是 + 或 -。

比如 5, (1-1), ((1+(2-3))-5) 都是表达式。

现在给出一个表达式，表达式中所有的运算符都被换成了问号。要求在问号处填入 $p$ 个 + 和 $m$ 个 -，问表达式的值最大可能是多少。

表达式的长度 $1 \le |E| \le 10^4$，$0 \le \min(p, m) \le 100$。

### 题解

不失一般性地，我们假设 $p \le m \le 100$。

整个表达式形成了一个树形结构。假设当前正在考虑以第 $i$ 个位置开头的那个子表达式（不难发现，以第 $i$ 个位置开头的合法表达式有且只有一个），记 $f(i, j)$ 表示向以 $i$ 为开头的表达式中填入 $j$ 个加号获得的最大值，$g(i, j)$ 表示获得的最小值。那么：$$f(i, j) = \max(f(i, k) + f(t+1, j-1-k), f(i, k) - g(t+1, j-k)) \\ g(i, j) = \min(g(i, k) + g(t+1, j-1-k), g(i, k) - f(t+1, j-k))$$ 其中 $k = 0 \sim j$，$t$ 是表达式中间问号所在的位置。当以第 $i$ 个位置开头的表达式只有一个数码时，如果 $j = 0$ 则表达式的值就是该数码，否则是无效表达式。这样的 DP 复杂度是 $O(|E|p^2)$。

最后的问题是怎样较快找到表达式中间问号所在的位置，不过 $|E|$ 只有 $10^4$，感觉 $O(|E|^2)$ 暴力也行，或者用 RMQ 找一下。

#### [AC 代码](https://github.com/TsReaper/Competitive-Programming/blob/master/codeforces/935E/sol.cpp)
