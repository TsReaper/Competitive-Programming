## [Codeforces 935F - Fafa and Array](http://codeforces.com/problemset/problem/935/F)

### 题意

给出长度为 $n$ 的数组 $A$，记 $f(A) = \displaystyle\sum_{i=1}^{n-1} |a_i - a_{i+1}|$。进行 $q$ 次操作，有以下两种：
* `1 l r x`：选择 $a_l \sim a_r$ 中的一个数，将其增加 $x$，使得 $f(A)$ 尽量大，求最大的 $f(A)$。注意：这个操作不改变原数组；
* `2 l r x`：将 $a_l \sim a_r$ 都增加 $x$。

$3 \le n \le 10^5$，$1 \le q \le 10^5$，其它数字是不超过 $10^9$ 的正整数。

### 题解

思考起来很简单，写起来有一些细节的数据结构题。

进行以下分类讨论：
* 如果区间是递增的，那么找到和下一个元素差值最小的元素，把它增加 $x$ 就是最佳答案（递减序列类似）；
* 如果区间是先递减后递增的，分成三部分判断：前半部分的递减序列和后半部分的递增序列判断类似于第一种情况，还有中间的那个数特判一下；
* 剩下的情况说明有一个数大等于两边的数，那么就把它增加 $x$ 就是最佳答案。

判断区间是否递增或者递减，只要用线段树维护一下差分就好了。判断一个区间是否先递减后递增，只要在线段树上“二分”就行了（有一种 $O(n\log n)$ 的“二分”，不需要 $O(n\log^2 n)$ 的）。

注意看一下 1 1 2，2 1 1 2，2 1 1 1 2 这种有连续相同数字的序列是否正确处理。

#### [AC 代码](https://github.com/TsReaper/Competitive-Programming/blob/master/codeforces/935F/sol.cpp)
